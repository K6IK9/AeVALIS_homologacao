{% load static %}
{% load user_tags %} 

<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Responder Avalia√ß√£o - IF SADD</title>

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Vidaloka&display=swap"
    rel="stylesheet" />

  <!-- CSS Files -->
  <link rel="stylesheet" href="{% static 'css/global.css' %}" />
  <link rel="stylesheet" href="{% static 'css/responder_avaliacao.css' %}" />
</head>

<body>
  <main>
    <div class="container">
      <a href="{% url 'inicio' %}" class="back-button">‚Üê Voltar</a>

      <!-- Header da p√°gina -->
      <div class="header">
        <h1>Responder Avalia√ß√£o</h1>
        <p>{{ avaliacao.disciplina.disciplina_nome }} - {{ avaliacao.turma.codigo_turma }}</p>
      </div>

      <!-- Mensagens -->
      {% include "partials/messages.html" %}

      <!-- Conte√∫do principal -->
      <div class="form-section">
        <!-- Informa√ß√µes da Avalia√ß√£o -->
        <div class="avaliacao-card">
          <div style="text-align: center">
            <h3>{{ titulo }}</h3>
            <p style="color: #666; margin: 10px 0">
              {{ avaliacao.disciplina.disciplina_nome }} - {{ avaliacao.turma.codigo_turma }}
            </p>
            <p style="color: #666">{{ avaliacao.ciclo.nome }}</p>

            {% if avaliacao.ciclo.anonimo %}
            <div class="message info">
              üîí <strong>Avalia√ß√£o An√¥nima:</strong> Suas respostas ser√£o
              mantidas em sigilo.
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Formul√°rio de Avalia√ß√£o -->
        <form method="post" id="form-avaliacao">
          {% csrf_token %} {% for qp in perguntas_questionario %}
          <div class="pergunta-card">
            <div class="pergunta-header">
              <h6 class="pergunta-numero">
                Pergunta {{ qp.ordem }} {% if qp.pergunta.obrigatoria %}
                <span class="obrigatorio">*</span>
                {% endif %}
              </h6>
              {% if qp.pergunta.categoria %}
              <span class="badge bg-secondary">{{ qp.pergunta.categoria.nome }}</span>
              {% endif %}
            </div>

            <p class="pergunta-titulo">{{ qp.pergunta.enunciado }}</p>

            {% if qp.pergunta.tipo == 'likert' %}
            <!-- Escala Likert -->
            <div class="likert-scale">
              <div class="likert-labels">
                <small>Discordo Totalmente</small>
                <small>Concordo Totalmente</small>
              </div>
              <div class="likert-options">
                {% for i in "12345"|make_list %}
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="pergunta_{{ qp.pergunta.id }}"
                    id="likert_{{ qp.pergunta.id }}_{{ i }}" value="{{ i }}" {% if qp.pergunta.obrigatoria %}required{% endif %} />
                  <label class="form-check-label" for="likert_{{ qp.pergunta.id }}_{{ i }}">
                    {{ i }}
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>

            {% elif qp.pergunta.tipo == 'nps' %}
            <!-- Net Promoter Score -->
            <div class="rating-container">
              <div style="
                    width: 100%;
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                  ">
                <small style="color: #666">0 - Nunca recomendaria</small>
                <small style="color: #666">10 - Certamente recomendaria</small>
              </div>
              <div style="
                    display: flex;
                    justify-content: center;
                    flex-wrap: wrap;
                    gap: 10px;
                  ">
                {% nps_scale as escala %} {% for i in escala %}
                <div class="rating-option">
                  <input type="radio" name="pergunta_{{ qp.pergunta.id }}" id="nps_{{ qp.pergunta.id }}_{{ i }}"
                    value="{{ i }}" {% if qp.pergunta.obrigatoria %}required{% endif %} />
                  <label for="nps_{{ qp.pergunta.id }}_{{ i }}">
                    <div class="rating-value">{{ i }}</div>
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>

            {% elif qp.pergunta.tipo == 'multipla_escolha' %}
            <!-- M√∫ltipla Escolha -->
            <div class="multipla-escolha">
              {% for opcao in qp.pergunta.opcoes_multipla_escolha %}
              <div class="form-check">
                <input class="form-check-input" type="radio" name="pergunta_{{ qp.pergunta.id }}"
                  id="multipla_{{ qp.pergunta.id }}_{{ forloop.counter }}" value="{{ opcao }}" {% if qp.pergunta.obrigatoria %}required{% endif %} />
                <label class="form-check-label" for="multipla_{{ qp.pergunta.id }}_{{ forloop.counter }}">
                  {{ opcao }}
                </label>
              </div>
              {% endfor %}
            </div>

            {% elif qp.pergunta.tipo == 'sim_nao' %}
            <!-- Sim/N√£o -->
            <div class="sim-nao">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="pergunta_{{ qp.pergunta.id }}"
                  id="sim_{{ qp.pergunta.id }}" value="Sim" {% if qp.pergunta.obrigatoria %}required{% endif %} />
                <label class="form-check-label option-yes" for="sim_{{ qp.pergunta.id }}">
                  ‚úÖ Sim
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="pergunta_{{ qp.pergunta.id }}"
                  id="nao_{{ qp.pergunta.id }}" value="N√£o" {% if qp.pergunta.obrigatoria %}required{% endif %} />
                <label class="form-check-label option-no" for="nao_{{ qp.pergunta.id }}">
                  ‚ùå N√£o
                </label>
              </div>
            </div>

            {% elif qp.pergunta.tipo == 'texto_livre' %}
            <!-- Texto Livre -->
            <div class="texto-livre">
              <textarea class="form-control" name="pergunta_{{ qp.pergunta.id }}" id="texto_{{ qp.pergunta.id }}" rows="4" placeholder="Digite sua resposta..." {% if qp.pergunta.obrigatoria %}required{% endif %} maxlength="200"></textarea>
            </div>
            {% endif %}
          </div>
          {% endfor %}

          <!-- Navega√ß√£o e Envio -->
          <div class="pergunta-navegacao">
            <a href="{% url 'listar_avaliacoes' %}" class="btn btn-secondary">
              ‚Üê Voltar
            </a>

            <div class="pergunta-numero">
              {{ perguntas_questionario|length }} pergunta{{ perguntas_questionario|length|pluralize }}
            </div>

            <button type="submit" class="btn"
              onclick="return confirm('Tem certeza que deseja enviar sua avalia√ß√£o? Ap√≥s o envio n√£o ser√° poss√≠vel alterar as respostas.')">
              Enviar Avalia√ß√£o ‚úì
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>
</body>

</html>